<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evidencias Mantenimientos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .dropzone {
            border: 2px dashed #6c757d;
            border-radius: 5px;
            padding: 10px;
            text-align: center;
            color: #6c757d;
            cursor: pointer;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        .dropzone.dragover {
            border-color: #007bff;
            background-color: #e9f7ff;
            color: #007bff;
        }
        .task-title {
            font-weight: bold;
            font-size: 1rem;
            text-align: center;
            flex: 0 0 50%;
        }
        .dropzone {
            flex: 0 0 50%;
        }
        .list-group-item {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }
        .footer {
            margin-top: 20px;
            font-size: 0.9rem;
            color: #6c757d;
            text-align: center;
        }
        #moduleInput {
            font-size: 1.25rem;
            font-weight: bold;
            text-transform: uppercase;
            text-align: center;
            border: 2px solid #007bff;
            border-radius: 5px;
        }
        .completed {
            text-decoration: line-through;
            opacity: 0.6;
        }
    </style>
</head>
<body class="container my-5">
    <h1 class="mb-4 text-center text-primary animate__animated animate__fadeIn">EVIDENCIAS MANTENIMIENTOS</h1>

    <div class="mb-4 text-center">
        <input type="text" id="moduleInput" class="form-control w-50 mx-auto" placeholder="ESCRIBA EL NOMBRE DEL MÓDULO" oninput="updateModule()">
    </div>

    <ul id="checklist" class="list-group mb-4">
        <li class="list-group-item" data-id="1">
            <span class="task-title">FOTO PMT IZQUIERDA</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="2">
            <span class="task-title">FOTO PMT DERECHA</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="3">
            <span class="task-title">FOTO GENERAL DEL PUNTO ANTES</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="4">
            <span class="task-title">FOTO GENERAL DEL PUNTO DESPUÉS</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="5">
            <span class="task-title">FOTO GENERAL DEL GABINETE ANTES</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="6">
            <span class="task-title">FOTO GENERAL DEL GABINETE DESPUÉS</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="7">
            <span class="task-title">FOTO GENERAL DE PANELES ANTES</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="8">
            <span class="task-title">FOTO GENERAL DE PANELES DESPUÉS</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="9">
            <span class="task-title">FOTO GENERAL DE SPT ANTES</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="10">
            <span class="task-title">FOTO GENERAL DE SPT DESPUÉS</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="11">
            <span class="task-title">EVIDENCIA MANTENIMIENTO FOTO DE TORQUE UNO</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="12">
            <span class="task-title">EVIDENCIA MANTENIMIENTO FOTO DE TORQUE DOS</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="13">
            <span class="task-title">EVIDENCIA MANTENIMIENTO FOTO DE MEDICION DE PANELES UNO</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="14">
            <span class="task-title">EVIDENCIA MANTENIMIENTO FOTO DE MEDICION DE PANELES DOS</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="15">
            <span class="task-title">CORRIENTE ENTRADA CONTROLADOR ANTES</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="16">
            <span class="task-title">CORRIENTE ENTRADA CONTROLADOR DESPUÉS</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="17">
            <span class="task-title">VOLTAJE ENTRADA CONTROLADOR ANTES</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="18">
            <span class="task-title">VOLTAJE ENTRADA CONTROLADOR DESPUÉS</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="19">
            <span class="task-title">CORRIENTE SALIDA CONTROLADOR ANTES</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="20">
            <span class="task-title">CORRIENTE SALIDA CONTROLADOR DESPUÉS</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="21">
            <span class="task-title">VOLTAJE SALIDA CONTROLADOR ANTES</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="22">
            <span class="task-title">VOLTAJE SALIDA CONTROLADOR DESPUÉS</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="23">
            <span class="task-title">CORRIENTE ARREGLO DE BATERÍAS ANTES</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="24">
            <span class="task-title">CORRIENTE ARREGLO DE BATERÍAS DESPUÉS</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="25">
            <span class="task-title">VOLTAJE ARREGLO DE BATERÍAS ANTES</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="26">
            <span class="task-title">VOLTAJE ARREGLO DE BATERÍAS DESPUÉS</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="27">
            <span class="task-title">CORRIENTE ENTRADA INVERSOR ANTES</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="28">
            <span class="task-title">CORRIENTE ENTRADA INVERSOR DESPUÉS</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="29">
            <span class="task-title">VOLTAJE ENTRADA INVERSOR ANTES</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="30">
            <span class="task-title">VOLTAJE ENTRADA INVERSOR DESPUÉS</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="31">
            <span class="task-title">CORRIENTE BREAKER ANTES</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="32">
            <span class="task-title">CORRIENTE BREAKER DESPUÉS</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="33">
            <span class="task-title">VOLTAJE BREAKER ANTES</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="34">
            <span class="task-title">VOLTAJE BREAKER DESPUÉS</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="35">
            <span class="task-title">DISPLAY INVERSOR ANTES UNO</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="36">
            <span class="task-title">DISPLAY INVERSOR ANTES DOS</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="37">
            <span class="task-title">DISPLAY INVERSOR DESPUÉS UNO</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="38">
            <span class="task-title">DISPLAY INVERSOR DESPUÉS DOS</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="39">
            <span class="task-title">PING A TODOS LOS EQUIPOS</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="40">
            <span class="task-title">LATENCIA DE LOS EQUIPOS</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="41">
            <span class="task-title">REPORTE DE MODBUS</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="42">
            <span class="task-title">VISUAL CCMV</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="43">
            <span class="task-title">REPORTE PRTG</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="44">
            <span class="task-title">BRAZO ARTICULADO</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="45">
            <span class="task-title">ESTRUCTURA DE PANELES</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="46">
            <span class="task-title">CORONA ANTIESCALATORIA</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="47">
            <span class="task-title">ESTRUCTURA METALICA</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="48">
            <span class="task-title">GABINETE CERRADO</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="49">
            <span class="task-title">POSTE INFRAESTRUCTURA</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="50">
            <span class="task-title">SILLETA DEL GABINETE Y ABRAZADERAS</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="51">
            <span class="task-title">SPT ESTADO DE CONEXIONES UNO</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="52">
            <span class="task-title">SPT ESTADO DE CONEXIONES DOS</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="53">
            <span class="task-title">SPT FOTO DE RESISTENCIA</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="54">
            <span class="task-title">SPT FOTO DE EQUIPOTENCIA</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="55">
            <span class="task-title">FOTO DE LAS CONEXIONES SNMP</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="56">
            <span class="task-title">BARAJES DEL GABINETE</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="57">
            <span class="task-title">CABLES VERDES GABINETE UNO</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="58">
            <span class="task-title">CABLES VERDES GABINETE DOS</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="59">
            <span class="task-title">SEÑAL DELANTERA UNO</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="60">
            <span class="task-title">SEÑAL TRASERA UNO</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="61">
            <span class="task-title">SEÑAL DELANTERA DOS</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="62">
            <span class="task-title">SEÑAL TRASERA DOS</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="63">
            <span class="task-title">FOTO CALIBRACIÓN UNO</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="64">
            <span class="task-title">FOTO CALIBRACIÓN DOS</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="65">
            <span class="task-title">FOTO CALIBRACIÓN TRES</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="66">
            <span class="task-title">EVIDENCIA DE LIMPIEZA UNO</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="67">
            <span class="task-title">EVIDENCIA DE LIMPIEZA DOS</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="68">
            <span class="task-title">EVIDENCIA DE LIMPIEZA TRES</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="69">
            <span class="task-title">EVIDENCIA DE LIMPIEZA CUATRO</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="70">
            <span class="task-title">EVIDENCIA DE LIMPIEZA QUINTO</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="71">
            <span class="task-title">EVIDENCIA DE LIMPIEZA SEXTO</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="72">
            <span class="task-title">EVIDENCIA DE LIMPIEZA SÉPTIMO</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>
        <li class="list-group-item" data-id="73">
            <span class="task-title">EVIDENCIA DE LIMPIEZA OCTAVO</span>
            <div class="dropzone">
                <i class="fas fa-upload"></i> Arrastra y suelta aquí o haz clic para seleccionar
            </div>
        </li>               
    </ul>

    <button class="btn btn-primary mb-3" onclick="showCompletedTasks()">Mostrar Tareas Completadas</button>
    <ul id="completedTasks" class="list-group mb-4" style="display: none;"></ul>
    <button class="btn btn-success mb-3" onclick="downloadAllImages()">Descargar Todas las Imágenes</button>
    <button class="btn btn-danger mb-3" onclick="clearAllData()">Limpiar Todo</button>

    <div class="footer">
        <p><strong>TENER EN CUENTA:</strong> Si los módulos presentan novedades, por favor descargar las imágenes de "EVIDENCIAS DE HALLAZGOS", las novedades de "SPT" y las novedades de "SEÑALIZACIÓN".</p>
    </div>

    <script>
        const checklist = document.getElementById('checklist');
        const completedTasks = document.getElementById('completedTasks');
        const moduleInput = document.getElementById('moduleInput');

        window.onload = () => {
            const savedModule = localStorage.getItem('moduleName') || "";
            moduleInput.value = savedModule;

            const savedData = JSON.parse(localStorage.getItem('checklistData')) || [];
            savedData.forEach(task => restoreTask(task));
        };

        document.querySelectorAll('.dropzone').forEach(dropzone => {
            dropzone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropzone.classList.add('dragover');
            });

            dropzone.addEventListener('dragleave', () => {
                dropzone.classList.remove('dragover');
            });

            dropzone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropzone.classList.remove('dragover');
                handleFile(e.dataTransfer.files[0], dropzone);
            });

            dropzone.addEventListener('click', () => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*';
                input.onchange = (e) => handleFile(e.target.files[0], dropzone);
                input.click();
            });
        });

        function handleFile(file, dropzone) {
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                const img = document.createElement('img');
                img.src = e.target.result;
                img.alt = file.name;
                img.width = 100;

                const parentLi = dropzone.closest('li');

                dropzone.textContent = '';
                dropzone.appendChild(img);

                parentLi.classList.add('completed');

                saveTask(parentLi, e.target.result);
                moveToCompleted(parentLi);
            };

            reader.readAsDataURL(file);
        }

        function moveToCompleted(task) {
            checklist.removeChild(task);
            completedTasks.appendChild(task);
        }

        function showCompletedTasks() {
            completedTasks.style.display = completedTasks.style.display === 'none' ? 'block' : 'none';
        }

        function downloadAllImages() {
            const allTasks = completedTasks.querySelectorAll('li');
            allTasks.forEach(task => {
                const img = task.querySelector('img');
                if (img) {
                    const taskName = task.querySelector('span').textContent.trim();
                    downloadImage(img.src, `${taskName}.jpg`);
                }
            });
        }

        function downloadImage(url, filename) {
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        function saveTask(task, imageBase64) {
            const moduleName = moduleInput.value.trim();
            localStorage.setItem('moduleName', moduleName);

            const data = {
                id: task.getAttribute('data-id'),
                name: task.querySelector('span').textContent.trim(),
                image: imageBase64,
                completed: task.classList.contains('completed')
            };

            let savedData = JSON.parse(localStorage.getItem('checklistData')) || [];
            savedData = savedData.filter(t => t.id !== data.id);
            savedData.push(data);

            localStorage.setItem('checklistData', JSON.stringify(savedData));
        }

        function restoreTask(taskData) {
            const task = checklist.querySelector(`[data-id="${taskData.id}"]`);
            if (task) {
                task.querySelector('span').textContent = taskData.name || `Tarea ${taskData.id}`;

                const dropzone = task.querySelector('.dropzone');
                dropzone.textContent = '';

                const img = document.createElement('img');
                img.src = taskData.image;
                img.alt = taskData.name;
                img.width = 100;
                dropzone.appendChild(img);

                if (taskData.completed) {
                    task.classList.add('completed');
                    completedTasks.appendChild(task);
                }
            }
        }

        function updateModule() {
            const moduleName = moduleInput.value.trim();
            localStorage.setItem('moduleName', moduleName);
        }

        function clearAllData() {
            localStorage.clear();
            location.reload();
        }
    </script>
</body>
</html>